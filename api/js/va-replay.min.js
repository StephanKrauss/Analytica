!function(){var e={entryPt:"#9F6",exitPt:"#F66",regPt:"#F0F",regLn:"#0CC",click:"#F00",dDrop:"#ABC",varCir:"#F99",cenPt:"#DDD",clust:"#00F",bgColor:"#555",bgLayer:!0,realTime:!0,dirVect:!1,layoutType:"liquid",drawAll:!0,drawCursor:!1,drawLine:!0,drawClick:!1,drawDirectionArrow:!1,drawClusters:!1,drawCentroid:!1,drawMouseStop:!1,drawVariableCircle:!1,drawRegistrationPoint:!1,logIndex:0,totalLogs:1,sid:0,trackurl:"track.php"},r=window.va2data,t=window.jsGraphics,i=window.va2fn;if("undefined"==typeof r)throw"user data is malformed or not set";if("undefined"==typeof t)throw"jsGraphics library not found";if("undefined"==typeof i)throw"auxiliar functions not found";if("function"!=typeof JSON.parse)throw"JSON parser not found";var o,a=JSON.parse(unescape(r.users)),n=a.length;if(n>1){for(var l=0;n>l;++l)if(a[l].avg){o=a[l];break}}else o=a[0];var s=[],d=[],c={i:0,j:1,jMax:0,play:null,jg:null,jgClust:null,jgHelper:null,page:{width:0,height:0},viewport:{width:0,height:0},discrepance:{x:1,y:1},paused:!1,mcursor:"mouse-pointer",createCanvas:function(e){var r=document.createElement("div");r.id=e,r.style.position="absolute",r.style.top=0,r.style.left=0,r.style.width="100%",r.style.height="100%",r.style.zIndex=i.getNextHighestDepth()+1;var o=document.createElement("div");o.id=e+"Help",o.style.zIndex=r.style.zIndex+1;var a=40,n=document.createElement("div");n.id=e+"Clust",n.style.position="absolute",n.style.top=0,n.style.left=0,n.style.width="100%",n.style.height="100%",n.style.opacity=a/100,n.style.filter="alpha(opacity="+a+")",n.style.zIndex=r.style.zIndex+2;var l=document.getElementsByTagName("body")[0],s=i.getBaseURL(),d=document.createElement("figure");d.id="mouse-pointer",d.style.backgroundImage="url("+s+"styles/cursor-normal.png)",d.style.position="absolute",d.style.top=0,d.style.left=0,d.style.width="18px",d.style.height="30px",d.style.padding=0,d.style.margin=0,d.style.zIndex=i.getNextHighestDepth()+1,l.appendChild(r),l.appendChild(o),l.appendChild(n),r.appendChild(d),c.jg=new t(r.id),c.jgHelper=new t(o.id),c.jgClust=new t(n.id),c.mcursor=document.getElementById(d.id)},setBgCanvas:function(r){var t=80,i=document.getElementById(r),o=document.createElement("div");o.id=r+"Bg",o.style.position="absolute",o.style.top=0,o.style.left=0,o.style.width=c.page.width+"px",o.style.height=c.page.height+"px",o.style.overflow="hidden",o.style.backgroundColor=e.bgColor,o.style.opacity=t/100,o.style.filter="alpha(opacity="+t+")",o.style.zIndex=i.style.zIndex-1;var a=document.getElementsByTagName("body")[0];a.appendChild(o)},drawLine:function(r,t){e.drawAll&&e.drawLine&&(c.mcursor.style.top=r.x+"px",c.mcursor.style.left=r.y+"px")},drawMousePointer:function(e,r){c.moveMousePointer(e,r)},printMousePointer:function(e,r,t,i){c.mcursor.style.left=e+"px",c.mcursor.style.top=r+"px"},moveMousePointer:function(e,r){var t=e.x,i=e.y,o=r.x,a=r.y;if(t>o){var n=o,l=a;o=t,a=i,t=n,i=l}var s=o-t,d=Math.abs(a-i),p=t,y=i,u=i>a?-1:1;if(s>=d){for(var g=d<<1,w=g-(s<<1),f=g-s,h=p;s>0;)--s,++p,f>0?(c.printMousePointer(h,y,p-h,1),y+=u,f+=w,h=p):f+=g;c.printMousePointer(h,y,o-h+1,1)}else{var g=s<<1,w=g-(d<<1),f=g-d,x=y;if(i>=a){for(;d>0;)--d,f>0?(c.printMousePointer(p++,y,1,x-y+1),y+=u,f+=w,x=y):(y+=u,f+=g);c.printMousePointer(o,a,1,x-a+1)}else{for(;d>0;)--d,y+=u,f>0?(c.printMousePointer(p++,x,1,y-x),f+=w,x=y):f+=g;c.printMousePointer(o,x,1,a-x+1)}}},drawClick:function(r,t,i){if(e.drawAll&&e.drawClick){var o;i?(o=6,c.jg.setColor(e.dDrop),c.jg.drawRect(r-o/2,t-o/2,o,o)):(o=10,c.jg.setColor(e.click),c.jg.setStroke(5),e.drawAll&&e.drawClick&&(c.jg.drawLine(r-o,t-o,r,t),c.jg.drawLine(r-o,t+o,r,t),c.jg.drawLine(r+o,t-o,r,t),c.jg.drawLine(r+o,t+o,r,t)),c.jg.setStroke(0)),c.jg.paint()}},drawDirectionArrow:function(r,t){if(e.drawAll&&e.drawDirectionArrow){var i=r.x-t.x,o=r.y-t.y,a=4;i>0&&o>0?c.jg.drawPolyline([t.x-a,t.x,t.x+a],[t.y+a,t.y,t.y+a]):0>i&&o>0?c.jg.drawPolyline([t.x-a,t.x,t.x-a],[t.y-a,t.y,t.y+a]):0>i&&0>o?c.jg.drawPolyline([t.x-a,t.x,t.x+a],[t.y-a,t.y,t.y-a]):i>0&&0>o&&c.jg.drawPolyline([t.x+a,t.x,t.x+a],[t.y-a,t.y,t.y+a]),c.jg.paint()}},drawCursor:function(r,t,i){e.drawAll&&e.drawCursor&&(c.jg.setColor(i),c.jg.fillPolygon([r,r,r+4,r+6,r+9,r+7,r+15],[t,t+15,t+15,t+23,t+23,t+15,t+15]),c.jg.paint())},drawRegistrationPoint:function(r,t){e.drawAll&&e.drawRegistrationPoint&&(c.jg.setColor(e.regPt),c.jg.fillRect(r-1,t-1,3,3),c.jg.paint())},drawVariableCircle:function(t,o,a){if(e.drawAll&&e.drawVariableCircle){var n=i.roundTo(a/c.jMax);a*n!==0&&(a>r.wcurr/2&&(a=Math.round(r.wcurr/2*n)),c.jg.setColor(e.varCir),c.jg.drawEllipse(t-a/2,o-a/2,a,a),c.jg.paint())}},drawMouseStop:function(r,t){if(e.realTime&&e.drawAll&&e.drawMouseStop){var i=16,o=50;c.jgHelper.setColor(e.varCir),c.jgHelper.fillEllipse(r-o/2,t-o/2,o,o),c.jgHelper.setColor("black"),c.jgHelper.setFont("sans-serif",i+"px",Font.BOLD),c.jgHelper.drawString("stopped...",r,t-i/2),c.jgHelper.paint()}},drawCentroid:function(){if(e.drawAll&&e.drawCentroid){c.jg.setColor(e.cenPt);var r=i.array.sum(s)/s.length,t=i.array.sum(d)/d.length;"liquid"==e.layoutType?(r*=c.discrepance.x,r*=c.discrepance.x):"center"==e.layoutType&&(r+=c.discrepance.x,r+=c.discrepance.x);var o=Math.round(r),a=Math.round(t),n=20;c.jg.setStroke(5),c.jg.drawLine(o,a,o+n,a-n),c.jg.drawLine(o,a,o-n,a-n),c.jg.drawLine(o,a,o-n,a+n),c.jg.drawLine(o,a,o+n,a+n),c.jg.setStroke(0),c.jg.paint()}},drawClusters:function(r){if(e.drawAll&&e.drawClusters){var t=JSON.parse(r);"object"!=typeof t&&(t=JSON.parse(t)),c.jgClust.setColor(e.clust);for(var i=0,o=0,a=t.sizes.length;a>i;++i)o=t.sizes[i],c.jgClust.fillEllipse(t.xclusters[i]*c.discrepance.x-o/2,t.yclusters[i]*c.discrepance.y-o/2,o,o);c.jgClust.paint()}},distance:function(e,r){return Math.sqrt(Math.pow(e.x-r.x,2)+Math.pow(e.y-r.y,2))},checkAutoScrolling:function(r,t){e.realTime&&i.doScroll({xpos:r,ypos:t,width:c.viewport.width,height:c.viewport.height})},playMouse:function(){if(!c.paused){var t={x:o.xcoords[c.i]*c.discrepance.x,y:o.ycoords[c.i]*c.discrepance.y},a={x:o.xcoords[c.i+1]*c.discrepance.x,y:o.ycoords[c.i+1]*c.discrepance.y},n=o.clicks[c.i],l=o.clicks[c.i+1],s=n>0?o.xcoords[c.i]:0,d=l>0?o.xcoords[c.i+1]:0,p=n>0?o.ycoords[c.i]:0,y=l>0?o.ycoords[c.i+1]:0,u={x:s*c.discrepance.x,y:p*c.discrepance.y},g={x:d*c.discrepance.x,y:y*c.discrepance.y};if(0===c.i&&c.drawCursor(t.x,t.y,e.entryPt),c.i<o.xcoords.length){var w=c.distance(t,a);if(w?(e.dirVect?c.drawDirectionArrow(t,a):c.drawRegistrationPoint(t.x,t.y),c.j>1&&(c.drawVariableCircle(t.x,t.y,c.j),c.jgHelper.clear()),c.j=1):(++c.j,c.drawMouseStop(t.x,t.y)),c.drawLine(t,a),c.drawMousePointer(t,a),u.x){var f=c.distance(u,g);f?0!==g.x&&c.drawClick(u.x,u.y,!0):c.drawClick(g.x,g.y,!1)}++c.i,c.checkAutoScrolling(a.x,a.y)}else{--c.i,t.x=o.xcoords[c.i]*c.discrepance.x,t.y=o.ycoords[c.i]*c.discrepance.y,c.drawCursor(t.x,t.y,e.exitPt);var h="xhr=1";h+="&xdata="+JSON.stringify(o.xcoords),h+="&ydata="+JSON.stringify(o.ycoords);i.getBaseURL();if(c.drawCentroid(),clearInterval(c.play),c.play=null,c.jgHelper.clear(),e.totalLogs>1&&e.logIndex<e.totalLogs-1){var x=e.logIndex+1,v=r.trackurl+"?sid="+e.sid+"&i="+x;window.location.href=v}}}},replay:function(e){if(e){var t=Math.round(1e3/r.fps);c.play=setInterval(c.playMouse,t)}else for(var i=0,a=o.xcoords.length;a>=i;++i)c.playMouse()},reset:function(){clearInterval(c.play),c.paused=!1,c.i=0,c.j=1,c.jg.clear(),c.jgClust.clear()},helpKeys:function(r){if(e.realTime){r||(r=window.event);var t=r.keyCode||r.which;if(27==t){clearInterval(c.play),c.paused=!1,e.realTime=!1;for(var i=c.i,a=o.xcoords.length;a>=i;++i)c.playMouse()}else 32==t&&(c.paused=!c.paused)}},init:function(){var r=i.getWindowSize();c.viewport.width=r.width,c.viewport.height=r.height;var t=i.getPageSize();c.page.width=t.width,c.page.height=t.height,o.wprev&&o.hprev&&(c.discrepance.x=i.roundTo(t.width/o.wprev),c.discrepance.y=i.roundTo(t.height/o.hprev));for(var a=[],n=1,l=0,p=o.xcoords.length;p>l;++l)o.xcoords[l]==o.xcoords[l+1]&&o.ycoords[l]==o.ycoords[l+1]?++n:(n>1&&a.push(n),n=1,s.push(o.xcoords[l]),d.push(o.ycoords[l]));c.jMax=i.array.max(a);var y="vaCanvas";c.createCanvas(y),e.bgLayer&&c.setBgCanvas(y),c.replay(e.realTime)}};if("undefined"!=typeof window.va2)throw"va2 namespace conflict";window.va2={replay:function(r){"undefined"!=typeof r&&i.overrideTrackingOptions(e,r),i.addEvent(document,"keyup",c.helpKeys),i.onDOMload(function(){i.allowTrackingOnFlashObjects(document)}),i.addEvent(window,"load",c.init)}}}();