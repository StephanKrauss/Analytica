jQuery.fn.scrollEnd=function(e,o){jQuery(this).scroll(function(){var t=jQuery(this);t.data("scrollTimeout")&&clearTimeout(t.data("scrollTimeout")),t.data("scrollTimeout",setTimeout(e,o))})},function(){var e={fps:24,recTime:0,postInterval:20,trackingServer:"",storageServer:"",warn:!1,warnText:"We'd like to study your mouse activity.\nDo you agree?",cookieDays:365,layoutType:"liquid",contRecording:!1,compress:!1,disabled:0,clearUserCookie:!0,apiUserId:0,scrollInitData:{xMousePos:0,yMousePos:0,lastScrolledLeft:0,lastScrolledTop:0},mouseMoveTimeOut:null,postDataTimeOut:null},o=window.va2fn;if("undefined"==typeof o)throw"Auxiliar va2fn functions not found";var t={i:0,mouse:{x:0,y:0},page:{width:0,height:0},coords:{x:[],y:[],p:[]},elem:{hovered:[],clicked:[]},url:null,rec:null,userId:null,vaId:null,append:null,paused:!1,clicked:!1,timestamp:null,timeout:null,xmlhttp:o.createXMLHTTPObject(),ftu:1,pauseRecording:function(){t.paused=!0},resumeRecording:function(){t.paused=!1},getMousePos:function(e){if(!e)var e=window.event;var o=0,n=0;e.pageX||e.pageY?(o=e.pageX,n=e.pageY):(e.clientX||e.clientY)&&(o=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,n=e.clientY+document.body.scrollTop+document.documentElement.scrollTop),(0>o||!o)&&(o=0),(0>n||!n)&&(n=0),t.mouse.x=o,t.mouse.y=n},getMousePosIFrame:function(e,o){t.pause=!1;var n=e.pageX||e.clientX,s=e.pageY||e.clientY,a=o.contentDocument||o.contentWindow;a.body&&(n-=a.body.scrollLeft,s-=a.body.scrollTop),a.documentElement&&(n-=a.documentElement.scrollLeft,s-=a.documentElement.scrollTop);var i=t.getFrameOffsets(o);n+=i.left,s+=i.top,t.mouse.x=n,t.mouse.y=s},getFrameOffsets:function(e){var o=e&&e.frameElement?e.frameElement:e,t=0,n=0;if(o&&o.offsetParent)do t+=o.offsetLeft,n+=o.offsetTop;while(o=o.offsetParent);return{left:t,top:n}},setClick:function(){t.clicked=!0},releaseClick:function(){t.clicked=!1},recMouse:function(){t.paused||(t.i<=t.timeout||0==t.timeout?(t.coords.x.push(t.mouse.x),t.coords.y.push(t.mouse.y),t.coords.p.push(+t.clicked)):(clearInterval(t.rec),clearInterval(t.append)),++t.i)},getCursorDataFields:function(){var n="&pagew="+t.page.width;return n+="&pageh="+t.page.height,e.compress?(n+="&xcoords="+o.LZW.compress(t.coords.x.join(",")),n+="&ycoords="+o.LZW.compress(t.coords.y.join(",")),n+="&clicks="+o.LZW.compress(t.coords.p.join(",")),n+="&elhovered="+o.LZW.compress(t.elem.hovered.join(",")),n+="&elclicked="+o.LZW.compress(t.elem.clicked.join(",")),n+="&compressed=1"):(n+="&xcoords="+t.coords.x,n+="&ycoords="+t.coords.y,n+="&clicks="+t.coords.p,n+="&elhovered="+t.elem.hovered,n+="&elclicked="+t.elem.clicked),n},initMouseData:function(o){t.computeAvailableSpace(),"undefined"==typeof t.session_id&&(t.session_id=0);var n="client="+t.vaId;n+="&user_id="+e.apiUserId,n+="&sess_id="+t.session_id,n+="&url="+t.url,n+="&urltitle="+document.title,n+="&cookies="+document.cookie,n+="&screenw="+screen.width,n+="&screenh="+screen.height,n+="&layout="+e.layoutType,n+="&time="+t.getBrowsingTime(),n+="&fps="+e.fps,n+="&ftu="+t.ftu,n+=t.getCursorDataFields(),n+="&action=store",n+="&remote="+e.storageServer,t.sendData({async:o,postdata:n,callback:t.setUserId}),t.clearMouseData()},setTrackingId:function(){var n;o.cookies.checkCookie("va-id")?n=o.cookies.getCookie("va-id"):(n=md5(String(Math.random()+(new Date).getTime()*Math.random())),o.cookies.setCookie("va-id",n,e.cookieDays)),t.vaId=n,o.cookies.checkCookie("va-userId")&&(t.userId=o.cookies.getCookie("va-userId")),o.cookies.checkCookie("va-sessId")&&(t.session_id=o.cookies.getCookie("va-sessId"))},setUserId:function(n){var s=JSON.parse(n);t.userId=parseInt(s.uid),t.session_id=parseInt(s.session_id),t.userId>0&&(o.cookies.setCookie("va-userId",t.userId,e.cookieDays),o.cookies.setCookie("va-sessId",t.session_id,e.cookieDays),t.append=setInterval(function(){t.appendMouseData(!0)},1e3*e.postInterval))},getBrowsingTime:function(){var e=(new Date).getTime()-t.timestamp;return e/1e3},appendMouseData:function(o){if(!t.rec||t.paused)return!1;"undefined"==typeof t.session_id&&(t.session_id=0);var n="uid="+t.userId;n+="&user_id="+e.apiUserId,n+="&cookies="+document.cookie,n+="&sess_id="+t.session_id,n+="&url="+t.url,n+="&time="+t.getBrowsingTime(),n+=t.getCursorDataFields(),n+="&action=append",n+="&remote="+e.storageServer,t.sendData({async:o,postdata:n}),t.clearMouseData()},sendData:function(n){n.url=o.ensureLastURLSlash(e.trackingServer)+"api/api.php",n.xmlhttp=t.xmlhttp,o.sendAjaxRequest(n)},flushData:function(){t.userId?t.appendMouseData(!1):t.initMouseData(!1)},clearMouseData:function(){t.coords.x=[],t.coords.y=[],t.coords.p=[],t.elem.hovered=[],t.elem.clicked=[]},findElement:function(e){e||(e=window.event),o.widget.findDOMElement(e,function(o){"mousedown"==e.type||"touchstart"==e.type?t.elem.clicked.push(o):"mousemove"!=e.type&&"touchmove"!=e.type||t.elem.hovered.push(o)})},computeAvailableSpace:function(){var e=o.getPageSize();t.page.width=e.width,t.page.height=e.height},trackIFrames:function(e){for(var n,s,a,i=e.getElementsByTagName("iframe"),c=function(e){o.addEvent(e,"mousedown",t.setClick),o.addEvent(e,"mouseup",t.releaseClick),o.addEvent(e,"touchstart",t.setClick),o.addEvent(e,"touchend",t.releaseClick)},r=0,d=i.length;d>r;++r)if(n=window.opera?i[r]:i[r].contentWindow||i[r].contentDocument,n.attachEvent&&!window.opera){var l=i[r].cloneNode(!0);i[r].parentNode.replaceChild(l,i[r]),i[r].onreadystatechange=function(e){"complete"===this.readyState&&(a=this.contentWindow,s=a.document,o.addEvent(s,"mousemove",function(e){t.getMousePosIFrame(this.parentWindow.event,this.frames.frameElement)}),o.addEvent(s,"touchmove",function(e){t.getMousePosIFrame(this.parentWindow.event,this.frames.frameElement)}),c(s))}}else n.frameElement&&(n=n.frameElement),o.addEvent(n,"load",function(e){a=e.target||e.srcElement,s=a.contentDocument,o.addEvent(s,"mousemove",function(e){t.getMousePosIFrame(e,a)}),o.addEvent(s,"touchmove",function(e){t.getMousePosIFrame(e,a)}),c(s)})},keyHandler:function(e){},clearUserCookie:function(){""!=document.referrer&&0===document.referrer.indexOf(location.protocol+"//"+location.host)?console.log("same session"):(console.log("new session"),o.cookies.deleteCookie("va-userId"),o.cookies.deleteCookie("va-id"),o.cookies.deleteCookie("va-sessId"))},mouseEvent:function(e,o,t,n,s){var a,i={bubbles:!0,cancelable:"mousemove"!=e,view:window,detail:0,screenX:o,screenY:t,clientX:n,clientY:s,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,button:0,relatedTarget:void 0};if("function"==typeof document.createEvent)a=document.createEvent("MouseEvents"),a.initMouseEvent(e,i.bubbles,i.cancelable,i.view,i.detail,i.screenX,i.screenY,i.clientX,i.clientY,i.ctrlKey,i.altKey,i.shiftKey,i.metaKey,i.button,document.body.parentNode);else if(document.createEventObject){a=document.createEventObject();for(prop in i)a[prop]=i[prop];a.button={0:1,1:4,2:2}[a.button]||a.button}return a},dispatchEvent:function(e,o){return e.dispatchEvent?e.dispatchEvent(o):e.fireEvent&&e.fireEvent("on"+type,o),o},onScroll:function(o){e.scrollInitData.lastScrolledLeft!=jQuery(document).scrollLeft()&&(e.scrollInitData.xMousePos-=e.scrollInitData.lastScrolledLeft,e.scrollInitData.lastScrolledLeft=$(document).scrollLeft(),e.scrollInitData.xMousePos+=e.scrollInitData.lastScrolledLeft),e.scrollInitData.lastScrolledTop!=jQuery(document).scrollTop()&&(e.scrollInitData.yMousePos-=e.scrollInitData.lastScrolledTop,e.scrollInitData.lastScrolledTop=jQuery(document).scrollTop(),e.scrollInitData.yMousePos+=e.scrollInitData.lastScrolledTop),jQuery(window).scrollEnd(function(){var e=document.referrer,o=window.location.href;""!=e&&e===o?t.session_id?t.appendMouseData(!0):t.initMouseData(!0):t.appendMouseData(!0),t.timestamp=(new Date).getTime()},500)},init:function(){e.clearUserCookie&&t.clearUserCookie(),t.setTrackingId(),t.computeAvailableSpace(),t.url=escape(window.location.href),t.timeout=e.fps*e.recTime;var n=Math.round(1e3/e.fps);t.rec=setInterval(t.recMouse,n),o.allowTrackingOnFlashObjects(document),t.trackIFrames(document);var s=function(e){e.touches&&(e=e.touches[0]||e.targetTouches[0]),t.getMousePos(e),t.findElement(e)},a=function(e){e.touches&&(e=e.touches[0]||e.targetTouches[0]),t.setClick(),t.findElement(e)};o.addEvent(document,"mousedown",a),o.addEvent(document,"mousemove",s),o.addEvent(document,"mouseup",t.releaseClick),o.addEvent(document,"touchstart",a),o.addEvent(document,"touchmove",s),o.addEvent(document,"touchend",t.releaseClick),o.addEvent(window,"resize",t.computeAvailableSpace),o.addEvent(window,"orientationchange",t.computeAvailableSpace),o.addEvent(window,"scroll",t.onScroll),e.contRecording||(document.attachEvent&&!window.opera?(o.addEvent(document.body,"focusout",t.pauseRecording),o.addEvent(document.body,"focusin",t.resumeRecording)):(o.addEvent(window,"blur",t.pauseRecording),o.addEvent(window,"focus",t.resumeRecording))),"function"==typeof window.onbeforeunload?o.addEvent(window,"beforeunload",t.flushData):o.addEvent(window,"unload",t.flushData),setTimeout(function(){t.initMouseData(!0)},500),t.timestamp=(new Date).getTime()}};window.va2={methods:t,record:function(n){"undefined"!=typeof n&&o.overrideTrackingOptions(e,n);var s=o.cookies.getCookie("va-ftu");if(!e.disabled||!s){if(t.ftu=0|!s,o.cookies.setCookie("va-ftu",t.ftu,e.cookieDays),e.warn){var a=o.cookies.checkCookie("va-agreed"),i=a?o.cookies.getCookie("va-agreed"):window.confirm(e.warnText);if(!i)return o.cookies.setCookie("va-agreed",1,e.cookieDays),!1;o.cookies.setCookie("va-agreed",1,e.cookieDays)}for(var c=document.getElementsByTagName("script"),r=0,d=c.length;d>r;++r){var l=c[r].src;if(/va-record/i.test(l)){var u=l.split("/"),m=o.array.indexOf(u,"va2");m&&!e.trackingServer&&(e.trackingServer=u.slice(0,m+1).join("/"))}}o.onDOMload(t.init)}}}}();